name: ci

on:
  push:
  pull_request:

permissions:
  contents: read
  issues: write
  models: read

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - run: |
          npm install -g @openai/codex

      - run: |
          codex --version

      - name: test
        env:
          OPENAI_API_KEY: ${{ secrets.GITHUB_TOKEN }}
        run: |
          mkdir -p ~/.codex
          # Replace `__GITHUB_PERSONAL_ACCESS_TOKEN__` with the actual token
          sed -i 's/__GITHUB_PERSONAL_ACCESS_TOKEN__/${{ secrets.GITHUB_TOKEN }}/g' config.toml
          cp config.toml ~/.codex/config.toml
          codex exec --full-auto "List issues in this repository."

      - name: Call AI model
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          curl "https://models.github.ai/inference/chat/completions" \
             -H "Content-Type: application/json" \
             -H "Authorization: Bearer $GITHUB_TOKEN" \
             -d '{
              "messages": [
                  {
                    "role": "user",
                    "content": "Explain the concept of recursion."
                  }
              ],
              "model": "openai/gpt-4o"
            }'
